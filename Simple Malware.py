import os
import json
import subprocess
import re

data_file = 'data.json'
# 'data.json' is where the dumped data is stored.
gathered_data = []

def get_user():
    try:
        os_username = os.getlogin()
    except Exception as e:
        os_username = str(e)
    gathered_data.append({"username": os_username})

def extract_ip(text):
    ip_pattern = re.compile(r'\b(?:\d{1,3}\.){3}\d{1,3}\b')
    # the pattern before gets any patterns of "xxx.xxx.xxx.xxx", or an IP adress
    ips = ip_pattern.findall(text)
    return ips if ips else None

def get_ip():
    try:
        proc = subprocess.Popen(['arp', '-a'], stdout=subprocess.PIPE, stderr=subprocess.PIPE)
        # it shouts out the 'arp -a' command to get all devices on the network's IP.
        stdout, stderr = proc.communicate()
        if stderr:
            ip_info = stderr.decode('utf-8')
        else:
            ip_info = stdout.decode('utf-8')
        extracted_ips = extract_ip(ip_info)
        gathered_data.append({"ip_addresses": extracted_ips})
    except Exception as e:
        gathered_data.append({"ip_error": str(e)})

def dump_data():
    # dumps all the data gotten to the 'data.json' file
    get_user()
    get_ip()
    with open(data_file, 'w') as f:
        json.dump(gathered_data, f, indent=4)

dump_data()
